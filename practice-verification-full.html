<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실습 페이지</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #ffffff;
            color: #3f4146;
        }

        /* Title Bar */
        .title-bar {
            background: #fafafa;
            border-bottom: 1px solid #e4e4e7;
            padding: 8px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .traffic-lights {
            display: flex;
            gap: 8px;
            margin-left: 8px;
        }

        .traffic-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .traffic-light.red { background: #ec6a5e; }
        .traffic-light.yellow { background: #f5c04f; }
        .traffic-light.green { background: #61c555; }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: #3f4146;
            margin-left: 8px;
        }

        .back-btn svg {
            flex-shrink: 0;
        }

        .title-bar-right {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-right: 8px;
        }

        .recording-badge {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: #ff6900;
            border-radius: 50%;
        }

        .recording-text {
            font-size: 13px;
            font-weight: 700;
            color: #09090b;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 32px);
        }

        /* Left Panel - Practice Area */
        .practice-panel {
            flex: 1;
            background: white;
            overflow-y: auto;
            min-width: 400px;
        }

        .practice-header {
            padding: 24px 24px 16px;
        }

        .practice-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .practice-title {
            font-size: 20px;
            font-weight: 600;
            color: #09090b;
            flex-shrink: 0;
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .progress-bar-bg {
            width: 154px;
            height: 12px;
            background: #f4f4f5;
            border-radius: 400px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: #ff6900;
            border-radius: 400px;
            transition: width 0.5s ease-out;
        }

        .progress-text {
            font-size: 14px;
            color: #3f4146;
        }

        .custom-practice-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: white;
            border: 1px solid #b5b5ba;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            color: #3f4146;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-practice-btn:hover {
            background: #fafafa;
        }

        /* Practice Content */
        .practice-content {
            padding: 24px;
        }

        .chapter {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .step-indicator {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid #e4e4e7;
            background: #f4f4f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #71717a;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .step-indicator:not(.checked):hover {
            background: #fff5ed;
            border-color: #ff6900;
        }

        .step-indicator.checked {
            background: #ff6900;
            border-color: #ff6900;
            color: white;
            cursor: default;
        }

        .step-indicator.checked::before {
            content: '';
            display: block;
            width: 16px;
            height: 16px;
            background-image: url('data:image/svg+xml,<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.3346 4L6.0013 11.3333L2.66797 8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .chapter-content {
            flex: 1;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .chapter-title {
            font-size: 16px;
            color: #09090b;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .chapter-title.checked span:first-child {
            color: #71717a;
            text-decoration: line-through;
        }

        .verified-badge {
            display: none;
            align-items: center;
            gap: 2px;
            font-size: 13px;
            font-weight: 700;
            color: #09090b;
            margin-left: 10px;
        }

        .verified-badge.active {
            display: inline-flex;
        }

        .verified-badge svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .toggle-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #71717a;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .toggle-btn:hover {
            background: #f4f4f5;
        }

        .toggle-btn svg {
            width: 16px;
            height: 16px;
            transition: transform 0.2s;
        }

        .toggle-btn.expanded svg {
            transform: rotate(180deg);
        }

        .chapter-body {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chapter-body.collapsed {
            display: none;
        }

        .instruction-list {
            padding-left: 20px;
            font-size: 14px;
            line-height: 1.5;
            color: #3f4146;
        }

        .instruction-list li {
            margin-bottom: 4px;
        }

        .verify-btn {
            padding: 6px;
            background: white;
            border: 1px solid #e4e4e7;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            color: #71717a;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 28px;
            width: fit-content;
            margin-top: 8px;
        }

        .verify-btn.hidden {
            display: none;
        }

        .verify-btn:hover {
            background: #f4f4f5;
        }

        /* 업로드된 이미지 썸네일 */
        .uploaded-image-container {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: #f4f4f5;
            border-radius: 8px;
            gap: 12px;
            align-items: center;
        }

        .uploaded-image-container.active {
            display: flex;
        }

        .thumbnail-wrapper {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            overflow: hidden;
            flex-shrink: 0;
            background: white;
            border: 1px solid #e4e4e7;
        }

        .thumbnail-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .action-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid #e4e4e7;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn.edit {
            color: #3f4146;
        }

        .action-btn.delete {
            color: #ef4444;
            border-color: #fca5a5;
        }

        .action-btn:hover {
            background: #fafafa;
        }

        .action-btn.delete:hover {
            background: #fef2f2;
        }

        /* Resizer */
        .resizer {
            width: 2px;
            background: #e4e4e7;
            cursor: col-resize;
            flex-shrink: 0;
            transition: background 0.2s;
            position: relative;
        }

        .resizer:hover {
            background: #a1a1aa;
        }

        .resizer:active {
            background: #71717a;
        }

        .resizer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -5px;
            right: -5px;
            bottom: 0;
            cursor: col-resize;
        }

        /* Right Panel - Chat */
        .chat-panel {
            width: 367px;
            background: white;
            display: flex;
            flex-direction: column;
            min-width: 300px;
            max-width: 600px;
        }

        .chat-header {
            padding: 13px;
            border-bottom: 1px solid #e4e4e7;
        }

        .chat-tabs {
            display: flex;
            background: #f4f4f5;
            border-radius: 8px;
            padding: 4px;
        }

        .chat-tab {
            flex: 1;
            padding: 4px 9px;
            background: transparent;
            border: none;
            font-size: 16px;
            color: #71717a;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .chat-tab.active {
            background: white;
            color: #3f4146;
            font-weight: 600;
            box-shadow: 0 1px 2px rgba(16, 24, 40, 0.09);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
        }

        .chat-empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 40px 20px;
        }

        .chat-empty-state.hidden {
            display: none;
        }

        .empty-state-title {
            font-size: 16px;
            font-weight: 600;
            color: #3f4146;
            text-align: center;
        }

        .empty-state-description {
            font-size: 14px;
            color: #71717a;
            text-align: center;
            line-height: 1.5;
            max-width: 280px;
        }

        .chat-message {
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
        }

        .chat-message.me {
            align-items: flex-end;
        }

        .message-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .avatar {
            width: 29px;
            height: 29px;
            border-radius: 50%;
            background: #f4f4f5;
            border: 1px solid #e4e4e7;
        }

        .username {
            font-size: 9px;
            color: #71717a;
        }

        .message-bubble {
            background: #fafafa;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
            color: #71717a;
            line-height: 1.5;
            margin-left: 8px;
            display: inline-block;
            width: fit-content;
            max-width: 70%;
        }

        .chat-timestamp {
            font-size: 12px;
            color: #71717a;
            margin-left: 8px;
            margin-top: 4px;
        }

        .chat-input {
            background: #fafafa;
            border-top: 1px solid #e4e4e7;
            padding: 6px 8px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .chat-input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 8px 12px;
        }

        .chat-input input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 14px;
            color: #71717a;
        }

        .chat-input input::placeholder {
            color: #71717a;
        }

        .upload-icon-btn {
            width: 16px;
            height: 16px;
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .upload-icon-btn svg {
            width: 16px;
            height: 16px;
            color: #71717a;
        }

        .send-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            padding: 6px;
            transition: all 0.2s;
        }

        .send-btn:hover {
            background: #f4f4f5;
        }

        .send-btn svg {
            width: 16px;
            height: 16px;
            color: #71717a;
        }

        /* 모달 오버레이 */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(16, 24, 40, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 모달 */
        .modal {
            background: white;
            border-radius: 12px;
            width: 406px;
            box-shadow: 0 20px 24px -4px rgba(16, 24, 40, 0.09),
                        0 8px 8px -4px rgba(16, 24, 40, 0.09);
            animation: slideUp 0.3s;
            overflow: hidden;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header-label {
            padding: 12px 24px 4px;
        }

        .modal-subtitle {
            font-size: 13px;
            font-weight: 700;
            color: #71717a;
            text-align: left;
        }

        .modal-text-container {
            padding: 24px 24px 12px;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: #09090b;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .modal-description {
            font-size: 14px;
            color: #71717a;
            line-height: 1.5;
        }

        .warning-box {
            margin: 0 24px 12px;
            padding: 12px;
            background: #fffbeb;
            border-left: 3px solid #f59e0b;
            border-radius: 4px;
            display: none;
            gap: 8px;
        }

        .warning-box.active {
            display: flex;
        }

        .warning-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            color: #71717a;
        }

        .warning-text {
            font-size: 13px;
            color: #92400e;
            line-height: 1.5;
        }

        .error-box {
            margin: 0 24px 12px;
            padding: 12px;
            background: #fef2f2;
            border-left: 3px solid #ef4444;
            border-radius: 4px;
            display: none;
            gap: 8px;
        }

        .error-box.active {
            display: flex;
        }

        .error-icon {
            color: #ef4444;
            flex-shrink: 0;
        }

        .error-text {
            font-size: 13px;
            color: #991b1b;
            line-height: 1.5;
        }

        .upload-container {
            padding: 12px 24px;
        }

        .upload-wrapper {
            background: #fafafa;
            border: 1px dashed #e4e4e7;
            border-radius: 6px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 4px;
            position: relative;
        }

        .upload-wrapper:hover {
            border-color: #ff6900;
            background: #fff5ed;
        }

        .upload-wrapper.has-image {
            padding: 0;
            border: none;
        }

        .upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .upload-icon {
            width: 24px;
            height: 24px;
            color: #71717a;
        }

        .upload-text-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .upload-title {
            font-size: 16px;
            font-weight: 600;
            color: #3f4146;
        }

        .upload-hint {
            font-size: 12px;
            color: #71717a;
        }

        .screenshot-info {
            font-size: 12px;
            color: #71717a;
            line-height: 1.5;
            text-align: center;
        }

        .screenshot-btn {
            border: 1px solid #e4e4e7;
            background: white;
            padding: 6px;
            border-radius: 4px;
            display: inline-flex;
            gap: 4px;
            align-items: center;
            justify-content: center;
            height: 28px;
            font-size: 14px;
            font-weight: 500;
            color: #71717a;
            cursor: pointer;
            transition: all 0.2s;
        }

        .screenshot-btn svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .screenshot-btn:hover {
            background: #fafafa;
        }

        .image-preview {
            display: none;
            position: relative;
        }

        .image-preview.active {
            display: block;
        }

        .preview-img {
            width: 100%;
            border-radius: 6px;
        }

        .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .image-action-buttons {
            display: none;
            gap: 4px;
            align-items: center;
            align-self: flex-end;
        }

        .image-action-buttons.active {
            display: flex;
        }

        .reupload-btn, .recapture-btn {
            background: white;
            border: 1px solid #e4e4e7;
            padding: 6px;
            display: flex;
            gap: 4px;
            align-items: center;
            justify-content: center;
            height: 28px;
            font-size: 14px;
            font-weight: 500;
            color: #71717a;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .reupload-btn svg, .recapture-btn svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .reupload-btn:hover, .recapture-btn:hover {
            background: #fafafa;
        }

        .upload-progress {
            display: none;
            padding: 24px;
            flex-direction: column;
            gap: 12px;
        }

        .upload-progress.active {
            display: flex;
        }

        .progress-label {
            font-size: 14px;
            color: #71717a;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f4f4f5;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #ff6900;
            transition: width 0.3s;
        }

        .button-group {
            padding: 12px 24px 24px;
        }

        .button-row {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            height: 44px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.cancel {
            background: #fafafa;
            border: 1px solid #b5b5ba;
            color: #3f4146;
        }

        .modal-btn.cancel:hover {
            background: #f4f4f5;
        }

        .modal-btn.submit {
            background: #ff6900;
            color: white;
        }

        .modal-btn.submit:hover {
            background: #e65f00;
        }

        .modal-btn.submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modal-btn.submit.loading {
            position: relative;
            color: transparent;
        }

        .modal-btn.submit.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin: -10px 0 0 -10px;
            border: 2px solid white;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .file-input {
            display: none;
        }


        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #ffffff;
            color: #09090b;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e4e4e7;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 2000;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.5;
            font-family: 'Pretendard', sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(400px);
            transition: opacity 0.3s, transform 0.3s, visibility 0.3s;
        }

        .toast.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
            animation: slideIn 0.3s;
        }

        .toast.error {
            border-color: #fca5a5;
            background: #fef2f2;
        }

        .toast::before {
            content: '';
            display: block;
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            background-image: url('data:image/svg+xml,<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="%2309090b"/><path d="M14 7L8.5 12.5L6 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.hiding {
            opacity: 0;
            visibility: hidden;
            transform: translateX(400px);
        }
    </style>
</head>
<body>
    <!-- Title Bar -->
    <div class="title-bar">
        <div style="display: flex; align-items: center;">
            <div class="traffic-lights">
                <div class="traffic-light red"></div>
                <div class="traffic-light yellow"></div>
                <div class="traffic-light green"></div>
            </div>
            <button class="back-btn" onclick="location.href='index.html'">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: rotate(180deg);">
                    <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                목록으로
            </button>
        </div>
        <div class="title-bar-right">
            <div class="recording-badge">
                <div class="recording-dot"></div>
                <span class="recording-text">녹화 중</span>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Practice Panel -->
        <div class="practice-panel">
            <div class="practice-header">
                <div class="practice-title-row">
                    <div class="practice-title">구글 폼 응답을 Gemini로 자동 분석하기</div>
                    <button class="custom-practice-btn">+ 맞춤형 실습</button>
                    <div class="progress-container">
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                        <span class="progress-text">0%</span>
                    </div>
                </div>
            </div>

            <div class="practice-content">
                <!-- Chapter 1 -->
                <div class="chapter">
                    <div class="step-indicator" id="stepIndicator1" onclick="openModal(1)">1</div>
                    <div class="chapter-content">
                        <div class="chapter-header">
                            <div class="chapter-title" id="chapterTitle1">
                                <span>Google Cloud Platform 설정</span>
                                <span class="verified-badge" id="badge1">
                                    <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="10" cy="10" r="10" fill="#09090b"/>
                                        <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    실습 인증
                                </span>
                            </div>
                            <button class="toggle-btn expanded" id="toggleBtn1" onclick="toggleChapter(1)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                        </div>
                        <div class="chapter-body" id="chapter1">
                            <ol class="instruction-list">
                                <li>Google Forms에서 새 폼을 생성합니다.</li>
                                <li>우측 상단 응답 탭을 클릭하고, 스프레드시트로 응답 수집을 선택해 새 스프레드시트를 만듭니다.</li>
                                <li>생성된 스프레드시트의 URL을 메모해 둡니다. 이후 Apps Script에서 해당 스프레드시트를 열어 데이터를 기록합니다.</li>
                            </ol>
                        </div>
                        <button class="verify-btn" id="verifyBtn1" onclick="openModal(1)">실습 완료하기</button>
                        <div class="uploaded-image-container" id="uploadedImage1">
                            <div class="thumbnail-wrapper">
                                <img class="thumbnail-img" id="thumbnail1" alt="업로드된 이미지">
                            </div>
                            <div class="thumbnail-actions">
                                <button class="action-btn edit" onclick="editImage(1)">수정하기</button>
                                <button class="action-btn delete" onclick="deleteImage(1)">삭제</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chapter 2 -->
                <div class="chapter">
                    <div class="step-indicator" id="stepIndicator2" onclick="openModal(2)">2</div>
                    <div class="chapter-content">
                        <div class="chapter-header">
                            <div class="chapter-title" id="chapterTitle2">
                                <span>Google Forms & 스프레드시트 연결</span>
                                <span class="verified-badge" id="badge2">
                                    <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="10" cy="10" r="10" fill="#09090b"/>
                                        <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    실습 인증
                                </span>
                            </div>
                            <button class="toggle-btn" id="toggleBtn2" onclick="toggleChapter(2)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                        </div>
                        <div class="chapter-body collapsed" id="chapter2">
                            <ol class="instruction-list">
                                <li>Google Forms에서 새 폼을 생성합니다.</li>
                                <li>우측 상단 응답 탭을 클릭하고, 스프레드시트로 응답 수집을 선택해 새 스프레드시트를 만듭니다.</li>
                                <li>생성된 스프레드시트의 URL을 메모해 둡니다. 이후 Apps Script에서 해당 스프레드시트를 열어 데이터를 기록합니다.</li>
                            </ol>
                        </div>
                        <button class="verify-btn" id="verifyBtn2" onclick="openModal(2)">실습 완료하기</button>
                        <div class="uploaded-image-container" id="uploadedImage2">
                            <div class="thumbnail-wrapper">
                                <img class="thumbnail-img" id="thumbnail2" alt="업로드된 이미지">
                            </div>
                            <div class="thumbnail-actions">
                                <button class="action-btn edit" onclick="editImage(2)">수정하기</button>
                                <button class="action-btn delete" onclick="deleteImage(2)">삭제</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chapter 3 -->
                <div class="chapter">
                    <div class="step-indicator" id="stepIndicator3" onclick="openModal(3)">3</div>
                    <div class="chapter-content">
                        <div class="chapter-header">
                            <div class="chapter-title" id="chapterTitle3">
                                <span>Google Forms & 스프레드시트 연결</span>
                                <span class="verified-badge" id="badge3">
                                    <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="10" cy="10" r="10" fill="#09090b"/>
                                        <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    실습 인증
                                </span>
                            </div>
                            <button class="toggle-btn" id="toggleBtn3" onclick="toggleChapter(3)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                        </div>
                        <div class="chapter-body collapsed" id="chapter3">
                            <ol class="instruction-list">
                                <li>Google Forms에서 새 폼을 생성합니다.</li>
                                <li>우측 상단 응답 탭을 클릭하고, 스프레드시트로 응답 수집을 선택해 새 스프레드시트를 만듭니다.</li>
                                <li>생성된 스프레드시트의 URL을 메모해 둡니다. 이후 Apps Script에서 해당 스프레드시트를 열어 데이터를 기록합니다.</li>
                            </ol>
                        </div>
                        <button class="verify-btn" id="verifyBtn3" onclick="openModal(3)">실습 완료하기</button>
                        <div class="uploaded-image-container" id="uploadedImage3">
                            <div class="thumbnail-wrapper">
                                <img class="thumbnail-img" id="thumbnail3" alt="업로드된 이미지">
                            </div>
                            <div class="thumbnail-actions">
                                <button class="action-btn edit" onclick="editImage(3)">수정하기</button>
                                <button class="action-btn delete" onclick="deleteImage(3)">삭제</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resizer -->
        <div class="resizer" id="resizer"></div>

        <!-- Chat Panel -->
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header">
                <div class="chat-tabs">
                    <button class="chat-tab active" onclick="switchChatTab('group')">단체 대화</button>
                    <button class="chat-tab" onclick="switchChatTab('ai')">AI 튜터</button>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-empty-state" id="chatEmptyState">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="24" cy="24" r="20" fill="#f4f4f5"/>
                        <path d="M16 22c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v8c0 1.1-.9 2-2 2H18c-1.1 0-2-.9-2-2v-8z" fill="#a1a1aa"/>
                        <path d="M18 20v-2c0-3.3 2.7-6 6-6s6 2.7 6 6v2" stroke="#a1a1aa" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="26" r="1.5" fill="#fff"/>
                    </svg>
                    <div class="empty-state-title" id="emptyStateTitle">아직 나눈 대화가 없어요</div>
                    <div class="empty-state-description" id="emptyStateDescription">다른 학생들과 실습 관련 질문을 자유롭게 나눠보세요!</div>
                </div>
            </div>
            <div class="chat-input">
                <div class="chat-input-wrapper">
                    <input type="text" id="chatInput" placeholder="메세지를 입력하세요" onkeypress="handleChatKeyPress(event)">
                </div>
                <button class="upload-icon-btn" onclick="handleImageUpload()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </button>
                <button class="send-btn" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header-label">
                <div class="modal-subtitle" id="modalSubtitle">체크리스트 1. Google Cloud 설정</div>
            </div>

            <div class="modal-text-container">
                <div class="modal-title">완료 화면을 캡처해주세요</div>
                <div class="modal-description">
                    실습 결과가 명확히 보이도록 이미 찍은 이미지를 업로드하거나 스크린샷을 찍어 제출하세요. 문제가 있을 시 강사가 확인 후 피드백을 드립니다.
                </div>
            </div>

            <div class="warning-box">
                <svg class="warning-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <div class="warning-text">
                    <strong>제출 전 확인:</strong> 스크린샷에 개인정보(이메일, API 키 등)가 포함되지 않았는지 확인하세요.
                </div>
            </div>

            <div class="error-box" id="errorBox">
                <span class="error-icon">⚠️</span>
                <div class="error-text" id="errorText"></div>
            </div>

            <div class="upload-container">
                <div class="upload-wrapper" id="uploadWrapper" onclick="triggerFileInput()">
                    <div class="upload-progress" id="uploadProgress">
                        <div class="progress-label">업로드 중...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>

                    <div class="upload-content" id="uploadContent">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M7 18a4.6 4.4 0 0 1 0 -9a5 4.5 0 0 1 11 2h1a3.5 3.5 0 0 1 0 7h-1" />
                            <polyline points="9 15 12 12 15 15" />
                            <path d="M12 12v9" />
                        </svg>
                        <div class="upload-text-group">
                            <div class="upload-title">이미지 파일을 드래그하거나<br>클릭하여 업로드 해주세요.</div>
                            <div class="upload-hint">사용가능한 확장자: JPEG, PNG</div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 12px; align-items: center;">
                            <div class="screenshot-info">
                                스크린샷 찍는 법:<br>
                                - Windows: Windows + Shift + S<br>
                                - macOS: Shift + Command + 3 (전체) / 4 (영역)
                            </div>
                            <button class="screenshot-btn" onclick="event.stopPropagation(); captureScreenshot()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                    <circle cx="12" cy="13" r="4"/>
                                </svg>
                                스크린샷 찍기
                            </button>
                        </div>
                    </div>

                    <div class="image-preview" id="imagePreview">
                        <img id="previewImg" class="preview-img" alt="미리보기">
                        <button class="remove-btn" onclick="event.stopPropagation(); removeImage()">×</button>
                    </div>
                </div>

                <div class="image-action-buttons" id="imageActionButtons">
                    <button class="reupload-btn" onclick="triggerFileInput()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        이미지 업로드 다시하기
                    </button>
                    <button class="recapture-btn" onclick="event.stopPropagation(); recaptureScreenshot()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                            <circle cx="12" cy="13" r="4"/>
                        </svg>
                        스크린샷 다시 찍기
                    </button>
                </div>
            </div>

            <div class="button-group">
                <div class="button-row">
                    <button class="modal-btn cancel" onclick="attemptClose()">취소</button>
                    <button class="modal-btn submit" id="submitBtn" disabled onclick="submitImage()">인증하기</button>
                </div>
            </div>

            <input type="file" id="fileInput" class="file-input" accept="image/jpeg,image/png" onchange="handleFileSelect(event)">
        </div>
    </div>


    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        let currentFile = null;
        let currentChapter = 1;
        const MAX_FILE_SIZE = 5 * 1024 * 1024;

        // 각 챕터의 업로드된 이미지 데이터를 저장
        const uploadedImages = {
            1: null,
            2: null,
            3: null
        };

        function toggleChapter(num) {
            const chapter = document.getElementById('chapter' + num);
            const btn = document.getElementById('toggleBtn' + num);
            chapter.classList.toggle('collapsed');
            btn.classList.toggle('expanded');
        }

        function openModal(chapterNum, isEditMode = false) {
            // 이미 인증 완료된 경우 모달을 열지 않음 (단, 수정 모드가 아닐 때만)
            const stepIndicator = document.getElementById('stepIndicator' + chapterNum);
            if (!isEditMode && stepIndicator && stepIndicator.classList.contains('checked')) {
                return;
            }

            currentChapter = chapterNum;

            // 챕터 제목 가져오기
            const chapterTitle = document.getElementById('chapterTitle' + chapterNum);
            const titleText = chapterTitle ? chapterTitle.querySelector('span').textContent : 'Google Cloud 설정';

            document.getElementById('modalSubtitle').textContent = `체크리스트 ${chapterNum}. ${titleText}`;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function attemptClose() {
            closeModal();
        }


        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            resetModal();
        }

        function resetModal() {
            currentFile = null;
            document.getElementById('uploadContent').style.display = 'flex';
            document.getElementById('imagePreview').classList.remove('active');
            document.getElementById('imageActionButtons').classList.remove('active');
            document.getElementById('uploadWrapper').classList.remove('has-image');

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.classList.remove('loading'); // 로딩 상태 제거

            document.getElementById('errorBox').classList.remove('active');
            document.getElementById('uploadProgress').classList.remove('active');

            // warning box 숨기기
            const warningBox = document.querySelector('.warning-box');
            if (warningBox) {
                warningBox.classList.remove('active');
            }
        }

        function triggerFileInput() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) handleFile(file);
        }

        const uploadWrapper = document.getElementById('uploadWrapper');
        uploadWrapper.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });

        uploadWrapper.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const files = e.dataTransfer.files;
            if (files.length > 0) handleFile(files[0]);
        });

        document.addEventListener('paste', (e) => {
            if (!document.getElementById('modalOverlay').classList.contains('active')) return;
            const items = e.clipboardData.items;
            for (let item of items) {
                if (item.type.indexOf('image') !== -1) {
                    handleFile(item.getAsFile());
                    showToast('클립보드에서 이미지를 붙여넣었습니다!');
                    break;
                }
            }
        });

        function handleFile(file) {
            hideError();

            if (!['image/jpeg', 'image/png'].includes(file.type)) {
                showError('JPEG 또는 PNG 형식의 이미지만 업로드 가능합니다.');
                return;
            }

            if (file.size > MAX_FILE_SIZE) {
                showError('파일 크기가 너무 큽니다. 최대 5MB까지 업로드 가능합니다.');
                return;
            }

            currentFile = file;
            simulateUpload(file);
        }

        function simulateUpload(file) {
            document.getElementById('uploadProgress').classList.add('active');
            document.getElementById('uploadContent').style.display = 'none';

            const progressFill = document.getElementById('progressFill');
            let progress = 0;

            const interval = setInterval(() => {
                progress += Math.random() * 30;
                if (progress > 100) progress = 100;
                progressFill.style.width = progress + '%';

                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('uploadProgress').classList.remove('active');
                        showPreview(file);
                    }, 300);
                }
            }, 150);
        }

        function showPreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('imagePreview').classList.add('active');
                document.getElementById('uploadWrapper').classList.add('has-image');
                document.getElementById('imageActionButtons').classList.add('active');
                document.getElementById('submitBtn').disabled = false;

                // 이미지 업로드 시 warning box 표시
                const warningBox = document.querySelector('.warning-box');
                if (warningBox) {
                    warningBox.classList.add('active');
                }
            };
            reader.readAsDataURL(file);
        }

        function removeImage() {
            if (confirm('이미지를 삭제하시겠습니까?')) {
                resetModal();
            }
        }

        async function captureScreenshot() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { mediaSource: 'screen' }
                });

                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();

                video.onloadedmetadata = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    stream.getTracks().forEach(track => track.stop());

                    canvas.toBlob((blob) => {
                        handleFile(new File([blob], `screenshot-${Date.now()}.png`, { type: 'image/png' }));
                    }, 'image/png');
                };
            } catch (error) {
                showError(error.name === 'NotAllowedError'
                    ? '화면 캡처 권한이 거부되었습니다.'
                    : '화면 캡처 중 오류가 발생했습니다.');
            }
        }

        // 스크린샷 다시 찍기 (이미지가 이미 업로드된 상태에서)
        async function recaptureScreenshot() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { mediaSource: 'screen' }
                });

                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();

                video.onloadedmetadata = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    stream.getTracks().forEach(track => track.stop());

                    canvas.toBlob((blob) => {
                        handleFile(new File([blob], `screenshot-${Date.now()}.png`, { type: 'image/png' }));
                        showToast('새로운 스크린샷이 캡처되었습니다!');
                    }, 'image/png');
                };
            } catch (error) {
                showError(error.name === 'NotAllowedError'
                    ? '화면 캡처 권한이 거부되었습니다.'
                    : '화면 캡처 중 오류가 발생했습니다.');
            }
        }

        function submitImage() {
            if (!currentFile) return;

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;

            setTimeout(() => {
                const success = Math.random() > 0.2;

                if (success) {
                    // 이미지 데이터를 저장 (FileReader로 base64 변환)
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        uploadedImages[currentChapter] = e.target.result;

                        // 썸네일 표시
                        const thumbnailImg = document.getElementById('thumbnail' + currentChapter);
                        const uploadedImageContainer = document.getElementById('uploadedImage' + currentChapter);

                        if (thumbnailImg && uploadedImageContainer) {
                            thumbnailImg.src = e.target.result;
                            uploadedImageContainer.classList.add('active');
                        }
                    };
                    reader.readAsDataURL(currentFile);

                    // 배지 표시
                    const badge = document.getElementById('badge' + currentChapter);
                    if (badge) {
                        badge.classList.add('active');
                    }

                    // 실습 인증하기 버튼 숨기기
                    const verifyBtn = document.getElementById('verifyBtn' + currentChapter);
                    if (verifyBtn) {
                        verifyBtn.classList.add('hidden');
                    }

                    // step indicator 체크
                    const stepIndicator = document.getElementById('stepIndicator' + currentChapter);
                    const chapterTitle = document.getElementById('chapterTitle' + currentChapter);
                    if (stepIndicator && !stepIndicator.classList.contains('checked')) {
                        stepIndicator.classList.add('checked');
                        stepIndicator.textContent = '';
                        chapterTitle.classList.add('checked');
                        // 프로그레스 바 업데이트
                        updateProgressBar();
                    }

                    closeModal();
                    showToast('실습 인증이 제출되었습니다! 강사가 곧 확인합니다.');
                } else {
                    submitBtn.classList.remove('loading');
                    submitBtn.disabled = false;
                    showError('제출 중 오류가 발생했습니다. 다시 시도해주세요.');
                }
            }, 2000);
        }


        function updateProgressBar() {
            // 전체 체크리스트 개수
            const totalSteps = 3;

            // 체크된 항목 개수 계산
            let checkedCount = 0;
            for (let i = 1; i <= totalSteps; i++) {
                const stepIndicator = document.getElementById('stepIndicator' + i);
                if (stepIndicator && stepIndicator.classList.contains('checked')) {
                    checkedCount++;
                }
            }

            // 진행률 계산
            const progress = Math.round((checkedCount / totalSteps) * 100);

            // 프로그레스 바 업데이트
            const progressBarFill = document.querySelector('.progress-bar-fill');
            const progressText = document.querySelector('.progress-text');

            if (progressBarFill) {
                progressBarFill.style.width = progress + '%';
            }

            if (progressText) {
                progressText.textContent = progress + '%';
            }
        }

        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorBox').classList.add('active');
        }

        function hideError() {
            document.getElementById('errorBox').classList.remove('active');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerHTML = message;
            toast.classList.remove('hiding');
            toast.classList.add('active');

            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => {
                    toast.classList.remove('active', 'hiding');
                }, 300);
            }, 3000);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('modalOverlay').classList.contains('active')) {
                attemptClose();
            }
        });

        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'modalOverlay') attemptClose();
        });

        // 더미 유저 데이터
        const dummyUsers = [
            { name: '김민수', avatar: '#4F46E5' },
            { name: '박지영', avatar: '#EC4899' },
            { name: '이준호', avatar: '#10B981' },
            { name: '최서연', avatar: '#F59E0B' }
        ];

        // 더미 유저 응답 메시지 풀
        const userResponses = [
            '오 저도 그거 궁금했어요!',
            '맞아요, 저도 같은 부분에서 막혔었는데',
            '혹시 이 부분은 어떻게 하셨나요?',
            '아 그렇게 하면 되는구나!',
            '감사합니다 덕분에 이해했어요',
            '저는 다르게 했는데 그것도 괜찮을까요?',
            '좋은 질문이네요 👍',
            '저도 비슷한 문제가 있었어요',
            '아직 여기까지 못왔는데 미리 봐둘게요',
            '이 방법이 더 효율적일 것 같아요'
        ];

        // 채팅 기능
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            // 내 메시지 추가
            addChatMessage(message, 'me');
            input.value = '';

            if (currentChatTab === 'group') {
                // 단체 대화: 더미 유저들의 랜덤 응답 (1-3명이 응답)
                const numResponses = Math.floor(Math.random() * 3) + 1; // 1~3명
                const respondingUsers = [...dummyUsers]
                    .sort(() => Math.random() - 0.5)
                    .slice(0, numResponses);

                respondingUsers.forEach((user, index) => {
                    const delay = 2000 + (index * 1500); // 2초, 3.5초, 5초 간격
                    setTimeout(() => {
                        const response = userResponses[Math.floor(Math.random() * userResponses.length)];
                        addChatMessage(response, 'user', user);
                    }, delay);
                });

                // AI 튜터 응답은 가장 마지막에 (확률 50%)
                if (Math.random() > 0.5) {
                    setTimeout(() => {
                        const aiResponses = [
                            '좋은 질문이네요! 도와드리겠습니다.',
                            '실습 진행 중 어려운 부분이 있으시면 언제든 질문해주세요.',
                            '잘 하고 계시네요! 계속 진행하시면 됩니다.',
                            '그 부분은 다음 단계에서 다루게 됩니다.'
                        ];
                        const randomResponse = aiResponses[Math.floor(Math.random() * aiResponses.length)];
                        addChatMessage(randomResponse, 'ai');
                    }, 2000 + (numResponses * 1500) + 1000);
                }
            } else {
                // AI 튜터 1:1: AI만 응답
                setTimeout(() => {
                    const aiResponses = [
                        '좋은 질문이네요! 도와드리겠습니다.',
                        '실습 진행 중 어려운 부분이 있으시면 언제든 질문해주세요.',
                        '잘 하고 계시네요! 계속 진행하시면 됩니다.',
                        '그 부분은 다음 단계에서 다루게 됩니다.',
                        '자세히 설명해드릴게요. 어떤 부분이 궁금하신가요?'
                    ];
                    const randomResponse = aiResponses[Math.floor(Math.random() * aiResponses.length)];
                    addChatMessage(randomResponse, 'ai');
                }, 1500);
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addChatMessage(text, sender, userData = null) {
            const messagesContainer = document.querySelector('.chat-messages');

            // Empty state 숨기기
            const emptyState = document.getElementById('chatEmptyState');
            if (emptyState && !emptyState.classList.contains('hidden')) {
                emptyState.classList.add('hidden');
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'me' ? 'chat-message me' : 'chat-message';

            const now = new Date();
            const timeStr = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;

            if (sender === 'me') {
                messageDiv.innerHTML = `
                    <div class="message-bubble" style="background: #fafafa; width: fit-content; max-width: 70%; padding: 6px 12px; border-radius: 8px 8px 0 8px; margin-right: 8px; margin-left: 0;">
                        ${text}
                    </div>
                    <div class="chat-timestamp" style="margin-right: 8px;">${timeStr}</div>
                `;
            } else if (sender === 'user') {
                // 더미 유저 메시지
                messageDiv.innerHTML = `
                    <div class="message-profile">
                        <div class="avatar" style="background: ${userData.avatar};"></div>
                        <span class="username">${userData.name}</span>
                    </div>
                    <div class="message-bubble">${text}</div>
                    <div class="chat-timestamp">${timeStr}</div>
                `;
            } else {
                // AI 튜터 메시지
                messageDiv.innerHTML = `
                    <div class="message-profile">
                        <div class="avatar"></div>
                        <span class="username">AI 튜터</span>
                    </div>
                    <div class="message-bubble">${text}</div>
                    <div class="chat-timestamp">${timeStr}</div>
                `;
            }

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function handleImageUpload() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    addChatMessage(`이미지를 업로드했습니다: ${file.name}`, 'me');

                    if (currentChatTab === 'ai') {
                        setTimeout(() => {
                            addChatMessage('이미지를 확인했습니다. 관련된 질문이 있으신가요?', 'ai');
                        }, 1500);
                    }
                }
            };
            input.click();
        }

        // 리사이저 기능
        (function initResizer() {
            const resizer = document.getElementById('resizer');
            const chatPanel = document.getElementById('chatPanel');

            if (!resizer || !chatPanel) {
                console.error('Resizer or chatPanel not found');
                return;
            }

            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            resizer.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isResizing = true;
                startX = e.clientX;
                startWidth = chatPanel.offsetWidth;
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                e.preventDefault();

                const diff = startX - e.clientX;
                const newWidth = startWidth + diff;

                // 최소/최대 너비 제한
                if (newWidth >= 300 && newWidth <= 600) {
                    chatPanel.style.width = newWidth + 'px';
                }
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });

            // 마우스가 창 밖으로 나갔을 때도 처리
            document.addEventListener('mouseleave', () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
        })();

        // 수정하기 기능 - 모달을 다시 열어서 이미지 재업로드
        function editImage(chapterNum) {
            openModal(chapterNum, true);

            // 기존에 업로드한 이미지가 있으면 미리보기로 표시
            if (uploadedImages[chapterNum]) {
                // 약간의 지연을 두어 모달이 열린 후 이미지 표시
                setTimeout(() => {
                    const previewImg = document.getElementById('previewImg');
                    const imagePreview = document.getElementById('imagePreview');
                    const uploadContent = document.getElementById('uploadContent');
                    const uploadWrapper = document.getElementById('uploadWrapper');
                    const imageActionButtons = document.getElementById('imageActionButtons');
                    const submitBtn = document.getElementById('submitBtn');
                    const warningBox = document.querySelector('.warning-box');

                    // 기존 이미지를 미리보기로 표시
                    previewImg.src = uploadedImages[chapterNum];
                    imagePreview.classList.add('active');
                    uploadContent.style.display = 'none';
                    uploadWrapper.classList.add('has-image');
                    imageActionButtons.classList.add('active');
                    submitBtn.disabled = false;

                    // warning box 표시
                    if (warningBox) {
                        warningBox.classList.add('active');
                    }

                    // base64를 Blob으로 변환하여 currentFile에 설정
                    fetch(uploadedImages[chapterNum])
                        .then(res => res.blob())
                        .then(blob => {
                            currentFile = new File([blob], `image-${chapterNum}.png`, { type: 'image/png' });
                        });
                }, 100);
            }
        }

        // 삭제 기능 - 실습 인증을 풀린 상태로 되돌리기
        function deleteImage(chapterNum) {
            if (!confirm('실습 인증을 취소하시겠습니까?\n업로드한 이미지가 삭제됩니다.')) {
                return;
            }

            // 이미지 데이터 삭제
            uploadedImages[chapterNum] = null;

            // 썸네일 숨기기
            const uploadedImageContainer = document.getElementById('uploadedImage' + chapterNum);
            if (uploadedImageContainer) {
                uploadedImageContainer.classList.remove('active');
            }

            // 배지 숨기기
            const badge = document.getElementById('badge' + chapterNum);
            if (badge) {
                badge.classList.remove('active');
            }

            // 실습 완료하기 버튼 다시 표시
            const verifyBtn = document.getElementById('verifyBtn' + chapterNum);
            if (verifyBtn) {
                verifyBtn.classList.remove('hidden');
            }

            // step indicator 체크 해제
            const stepIndicator = document.getElementById('stepIndicator' + chapterNum);
            const chapterTitle = document.getElementById('chapterTitle' + chapterNum);
            if (stepIndicator) {
                stepIndicator.classList.remove('checked');
                stepIndicator.textContent = chapterNum;
            }
            if (chapterTitle) {
                chapterTitle.classList.remove('checked');
            }

            // 프로그레스 바 업데이트
            updateProgressBar();

            showToast('실습 인증이 취소되었습니다.');
        }

        // 채팅 탭 전환
        let currentChatTab = 'group';
        const groupMessages = [];
        const aiMessages = [];

        function switchChatTab(tab) {
            // 현재 메시지 저장
            const messagesContainer = document.getElementById('chatMessages');
            const currentMessages = Array.from(messagesContainer.children).filter(
                child => !child.classList.contains('chat-empty-state')
            );

            if (currentChatTab === 'group') {
                groupMessages.length = 0;
                groupMessages.push(...currentMessages);
            } else {
                aiMessages.length = 0;
                aiMessages.push(...currentMessages);
            }

            // 탭 전환
            currentChatTab = tab;

            // 탭 UI 업데이트
            const tabs = document.querySelectorAll('.chat-tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // 메시지 업데이트
            messagesContainer.innerHTML = '';
            const messagesToShow = tab === 'group' ? groupMessages : aiMessages;

            if (messagesToShow.length === 0) {
                // Empty state 표시
                const emptyState = document.createElement('div');
                emptyState.className = 'chat-empty-state';
                emptyState.id = 'chatEmptyState';

                if (tab === 'group') {
                    emptyState.innerHTML = `
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="24" cy="24" r="20" fill="#f4f4f5"/>
                            <circle cx="18" cy="22" r="6" fill="#a1a1aa"/>
                            <circle cx="30" cy="22" r="6" fill="#a1a1aa"/>
                            <path d="M12 32c0-6.6 5.4-12 12-12s12 5.4 12 12" stroke="#a1a1aa" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <div class="empty-state-title">아직 나눈 대화가 없어요</div>
                        <div class="empty-state-description">다른 학생들과 실습 관련 질문을 자유롭게 나눠보세요!</div>
                    `;
                } else {
                    emptyState.innerHTML = `
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="24" cy="24" r="20" fill="#f4f4f5"/>
                            <circle cx="24" cy="20" r="6" fill="#a1a1aa"/>
                            <path d="M14 34c0-5.5 4.5-10 10-10s10 4.5 10 10" stroke="#a1a1aa" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="30" cy="14" r="3" fill="#10B981"/>
                            <path d="M28 13h4M30 11v4" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <div class="empty-state-title">AI 튜터에게 질문해보세요</div>
                        <div class="empty-state-description">실습 중 막히는 부분이 있다면 언제든지 질문해주세요. 친절하게 답변드릴게요!</div>
                    `;
                }

                messagesContainer.appendChild(emptyState);
            } else {
                messagesToShow.forEach(msg => messagesContainer.appendChild(msg.cloneNode(true)));
            }

            // 스크롤 맨 아래로
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html>
